@model List<Diet_Project1.Models.student>

@{
    ViewBag.Title = "diet-View_Student";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/assets/css/styleSheet1.css" rel="stylesheet" />
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-12">
                <h1 class="m-0">Student List</h1>
            </div><!-- /.col -->
            <!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>

<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <div class="container-fluid">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <div class="dropdown">
                                            <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                Select Student By College
                                            </button>
                                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="actionDropdown">
                                                <!-- Dropdown options will be dynamically populated here -->
                                            </div>
                                        </div>
                                        <div class="mx-2"></div> <!-- Add horizontal margin between the dropdown button and the input -->
                                        <input type="text" id="selectedCollege" readonly class="form-control" placeholder="Selected College" />
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="filterdiv mt-2">
                                        <!-- Use mt-2 for top margin on smaller screens -->
                                        @using (Html.BeginForm("student_pdfdownload", "diet", FormMethod.Post))
                                        {
                                            <button id="btnpdf" class="btn btn-primary btn-sm">Pdf</button>
                                        }

                                        @using (Html.BeginForm("student_exceldownload", "diet", FormMethod.Post))
                                        {
                                            <button id="btnexcel" class="btn btn-success btn-sm">Excel</button>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-body">
                        <!--<div class="filterdiv mt-2">-->
                            <!-- ... Other buttons ... -->

                            <!--<button id="btnCheck" class="btn btn-secondary btn-sm">Check</button>
                            <button id="btnUncheck" class="btn btn-secondary btn-sm">Uncheck</button>
                        </div>-->
                        <table id="tbl" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>S.No.</th>
                                    <th>Student Name</th>
                                    <th>User Name</th>
                                    <th>Semester</th>
                                    <th>Batch</th>
                                    <th>Mobile No.</th>
                                    <th>City</th>
                                    <th>Image</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    int serialNumber = 1; // Initialize the serial number counter
                                }
                                @foreach (var item in Model)
                                {
                                    <tr>
                                        <th>@serialNumber</th>
                                        <th>@item.name</th>
                                        <td>@item.user_name</td>
                                        <td>@item.semester</td>
                                        <td>@item.batch</td>
                                        <td>@item.mobile</td>
                                        <td>@item.city</td>
                                        <td><img src="@item.student_image" style="height:50px; width:80px;" /></td>
                                        <td>
                                            <a href="/diet/StudentRegistration?student_id=@(item.student_id)" title="edit"><i class="fas fa-edit" style="color: #28a745"></i></a>
                                            <a href="#" class="delete-student" data-student-id="@item.student_id" title="delete"><i class="fas fa-regular fa-trash" style="color:red"></i></a>
                                            <a href="/diet/ViewStudentDetails?student_id=@(item.student_id)" title="view"><i class="fas fa-regular fa-eye" style="color:orange"></i></a>
                                        </td>
                                    </tr>
                                    { serialNumber++; }// Increment the serial number after each row
                                }

                            </tbody>
                        </table>
                    </div>
                    <!-- /.card-body -->
                </div>

                <!-- /.card -->
            </div>
            <!-- /.col -->
        </div>
        <!-- /.row -->
    </div>
    <!-- /.container-fluid -->
</section>
<!-- /.content -->
<script>
    $(document).ready(function () {
    // Fetch data from the server and populate the dropdown
    $.ajax({
        url: '@Url.Action("StudentByCollege", "diet")',
        type: 'GET',
        success: function (data) {
            var dropdownContainer = $('#actionDropdown');
            dropdownContainer.empty(); // Clear existing options

            dropdownContainer.append('<a class="dropdown-item default-students-link" href="">Default Students</a>');

            // Add static option for "View All Students"
            dropdownContainer.append('<a class="dropdown-item" href="#" data-college-id="">View All College Students</a>');

            // Append options to the dropdown
            data.forEach(function (item) {
                dropdownContainer.append('<a class="dropdown-item" href="#" data-college-id="' + item.user_name + '">' + item.college_name + '</a>');
            });

            // Add click event handler to dropdown items
            dropdownContainer.find('.dropdown-item').click(function (e) {
                e.preventDefault();

                var college_id = $(this).data('college-id');
                var college_name = $(this).text(); // Get the text of the selected dropdown item

                // Set the selected college name in the readonly input
                $('#selectedCollege').val(college_name);

                // Load data into the table based on the selected collegeId
                loadDataIntoTable(college_id);
            });
        },
        error: function (error) {
            // Handle errors
            console.error(error);
        }
    });
 });

    // Add click event handler for "Default Students" link
    $('#actionDropdown').on('click', '.default-students-link', function (e) {
        e.preventDefault();
        // Reload the page
        location.reload();
    });

    // Function to load data into the table based on the selected collegeId
function loadDataIntoTable(college_id) {
    // Fetch data for the selected collegeId from the server
    $.ajax({
        url: '@Url.Action("GetStudentsByCollege", "diet")',
        type: 'Post',
        data: { college_id: college_id },
        success: function (tableData) {
            console.log('Received data:', tableData);
            // Create or update the table with the fetched data
            var tableContainer = $('#tbl');
            tableContainer.empty();

            var tableHtml = '<table class="table table-bordered table-hover">' +
                '<thead>' +
                '<tr>' +
                '<th>S.No.</th>' +
                '<th>College Name</th>' +
                '<th>Student Name</th>' +
                '<th>User Name</th>' +
                '<th>Password</th>' +
                '<th>Batch</th>' +
                '<th>Mobile No.</th>' +
                '<th>City</th>' +
                '<th>Image</th>' +
                '<th></th>' +
                '</tr>' +
                '</thead>' +
                '<tbody>';

            // Append rows to the table
            tableData.forEach(function (item, index) {
                tableHtml += '<tr>' +
                    '<td>' + (index + 1) + '</td>' +  // Serial number starts from 1
                    '<td>' + item.college_name + '</td>' +
                    '<th>' + item.name + '</th>' +
                    '<td>' + item.user_name + '</td>' +
                    '<td>' + item.password + '</td>' +
                    '<td>' + item.batch + '</td>' +
                    '<td>' + item.mobile + '</td>' +
                    '<td>' + item.city + '</td>' +
                    '<td><img src="' + item.student_image + '" style="height:50px; widtd:80px;" /></td>' +
                    '<td> <a href="/diet/ViewCollegeStudentDetails?student_id=' + item.student_id + '" title="view"><i class="fas fa-regular fa-eye" style="color:orange"></i></a></td>' +
                    '</tr>';
            });

            tableHtml += '</tbody></table>';
            tableContainer.append(tableHtml);
        },
        error: function (error) {
            // Handle errors
            console.error(error);
        }
    });
}
</script>

<script>
    $(document).ready(function () {
        // Add a click event handler to the delete button with the class "delete-student"
        $('.delete-student').click(function (e) {
            e.preventDefault();

            // Get the student ID from the data attribute
            var studentId = $(this).data('student-id');

            // Show a confirmation dialog using Swal
            Swal.fire({
                title: 'Are you sure?',
                text: 'You won\'t be able to revert this!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    // If the user clicks "Yes," proceed with the deletion
                    window.location.href = '/diet/delete_Student?student_id=' + studentId;
                }
            });
        });
    });
</script>